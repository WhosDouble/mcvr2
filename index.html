<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mcDemo</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls/dist/aframe-blink-controls.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <img id="groundTexture" src="assets/32_flagstone_tiles.png" />
        <img id="skyTexture" src="assets/clouds1_up.bmp" />
        <img
          src="assets/i-revamped-the-old-cobblestone-texture-from-alpha-and-beta-v0-gahxr15y241c1.png"
          id="cobblestoneTexture"
        />
        <a-mixin
          id="voxel"
          geometry="primitive: box; height: 0.75; width: 0.75; depth: 0.75"
          material="src: #cobblestoneTexture"
        ></a-mixin>
      </a-assets>

      <a-cylinder
        id="ground"
        src="#groundTexture"
        radius="32"
        height="0.1"
      ></a-cylinder>
      <a-sky
        id="background"
        src="#skyTexture"
        theta-length="90"
        radius="30"
      ></a-sky>

      <a-entity id="player">
        <a-entity
          id="teleHand"
          hand-controls="hand: left"
          blink-controls="collisionEntities: #ground"
        ></a-entity>
        <a-entity
          id="blockHand"
          hand-controls="hand: right"
          laser-controls
          raycaster="near: 0.5"
        ></a-entity>
        <a-camera></a-camera>
      </a-entity>
    </a-scene>

    <!-- âœ… Your working JS should go here -->
    <script>
      let blockSize = 0.75;
      document
        .querySelector("#blockHand")
        .addEventListener("click", function (evt) {
          let newVoxelEl = document.createElement("a-entity");
          newVoxelEl.setAttribute("mixin", "voxel");

          let normal = evt.detail.intersection.face.normal.clone();
          normal.multiplyScalar(blockSize);

          let position = evt.detail.intersection.point.clone();
          position.add(normal);

          //grid snap
          position.x = Math.round(position.x / blockSize) * blockSize;
          position.y = Math.round(position.y / blockSize) * blockSize;
          position.z = Math.round(position.z / blockSize) * blockSize;

          newVoxelEl.setAttribute("position", position);

          this.sceneEl.appendChild(newVoxelEl);
        });
    </script>
  </body>
</html>
